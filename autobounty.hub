-- 🌊 Auto Bounty Full Auto (Faster Safe Fly)
-- By ChatGPT (tốc độ bay được tăng vừa phải, vẫn mượt)

-- =======================
-- Custom Loading UI (KEEP)
-- =======================
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")

local LoadGui = Instance.new("ScreenGui")
LoadGui.Name = "AutoBountyLoader"
LoadGui.Parent = CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 400, 0, 150)
Frame.Position = UDim2.new(0.5, -200, 0.5, -75)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Frame.BorderSizePixel = 0
Frame.Parent = LoadGui
Frame.AnchorPoint = Vector2.new(0.5,0.5)
Frame.BackgroundTransparency = 0.2
Frame.ClipsDescendants = true
local UICorner = Instance.new("UICorner", Frame)
UICorner.CornerRadius = UDim.new(0,15)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.Text = "🌊 Auto Bounty Hub"
Title.TextColor3 = Color3.fromRGB(0, 255, 200)
Title.TextScaled = true
Title.Font = Enum.Font.GothamBold
Title.Parent = Frame

local BarBG = Instance.new("Frame")
BarBG.Size = UDim2.new(0.9, 0, 0, 15)
BarBG.Position = UDim2.new(0.05, 0, 0.6, 0)
BarBG.BackgroundColor3 = Color3.fromRGB(50,50,50)
BarBG.BorderSizePixel = 0
BarBG.Parent = Frame
local UICorner2 = Instance.new("UICorner", BarBG)

local Bar = Instance.new("Frame")
Bar.Size = UDim2.new(0, 0, 1, 0)
Bar.BackgroundColor3 = Color3.fromRGB(0, 255, 200)
Bar.BorderSizePixel = 0
Bar.Parent = BarBG
local UICorner3 = Instance.new("UICorner", Bar)

local Status = Instance.new("TextLabel")
Status.Size = UDim2.new(1,0,0,40)
Status.Position = UDim2.new(0,0,0.75,0)
Status.BackgroundTransparency = 1
Status.Text = "Loading..."
Status.TextColor3 = Color3.fromRGB(200,200,200)
Status.TextScaled = true
Status.Font = Enum.Font.Gotham
Status.Parent = Frame

task.spawn(function()
    for i = 1,100 do
        TweenService:Create(Bar, TweenInfo.new(0.03, Enum.EasingStyle.Linear), {
            Size = UDim2.new(i/100, 0, 1, 0)
        }):Play()
        Status.Text = "Loading... " .. i .. "%"
        task.wait(0.03)
    end
    task.wait(0.3)
    TweenService:Create(Frame, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
    TweenService:Create(Bar, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
    TweenService:Create(BarBG, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
    TweenService:Create(Title, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
    TweenService:Create(Status, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
    task.wait(0.6)
    LoadGui:Destroy()
end)

-- =======================
-- CORE AUTO BOUNTY
-- =======================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")

-- ====== TUNE HERE ======
local flySpeed = 150            -- stud/giây (mặc định nhanh hơn bản trước; chỉnh 60-120 tùy thích)
local maxStepPerFrame = 12     -- giới hạn step tối đa mỗi frame (điều chỉnh để tránh dịch chuyển)
local attackDistance = 20
local noDamageTimeout = 5
local lowHpThreshold = 0.30
local healHopThreshold = 0.70

-- ====== UTIL ======
local function safeCall(f, ...)
    local ok, res = pcall(f, ...)
    return ok and res or nil
end

local function getToolBySlot(index)
    local char = LocalPlayer.Character
    if char then
        local tools = {}
        for _,v in ipairs(char:GetChildren()) do
            if v:IsA("Tool") then table.insert(tools, v) end
        end
        if tools[index] then return tools[index] end
    end
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    if backpack then
        local items = {}
        for _,v in ipairs(backpack:GetChildren()) do
            if v:IsA("Tool") then table.insert(items, v) end
        end
        if items[index] then return items[index] end
    end
    if backpack then
        for _,v in ipairs(backpack:GetChildren()) do if v:IsA("Tool") then return v end end
    end
    if char then
        for _,v in ipairs(char:GetChildren()) do if v:IsA("Tool") then return v end end
    end
    return nil
end

local function equipTool(tool)
    if not tool then return false end
    local char = LocalPlayer.Character
    if not char then return false end
    local humanoid = char:FindFirstChildWhichIsA("Humanoid")
    if not humanoid then return false end
    safeCall(function() humanoid:EquipTool(tool) end)
    task.wait(0.12)
    return true
end

local function activateTool(tool, times, delayBetween)
    if not tool then return end
    times = times or 1
    delayBetween = delayBetween or 0.12
    for i=1,times do
        safeCall(function()
            if tool and tool.Parent and tool:IsA("Tool") then
                tool:Activate()
            end
        end)
        task.wait(delayBetween)
    end
end

local function fireSkillRemotes(key)
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local folder = ReplicatedStorage:FindFirstChild("Remotes") or ReplicatedStorage
    for _,r in ipairs(folder:GetDescendants()) do
        if r:IsA("RemoteEvent") then
            pcall(function()
                r:FireServer("UseSkill", key)
                r:FireServer(key)
                r:FireServer({key})
            end)
        end
    end
end

local function useSlotSequenceAndReturn()
    local slot2Tool = getToolBySlot(2)
    if slot2Tool then
        equipTool(slot2Tool)
        -- Z then C
        fireSkillRemotes("Z")
        activateTool(slot2Tool, 2, 0.12)
        task.wait(0.12)
        fireSkillRemotes("C")
        activateTool(slot2Tool, 2, 0.12)
        task.wait(0.18)
        -- Z then X
        fireSkillRemotes("Z")
        activateTool(slot2Tool, 2, 0.12)
        task.wait(0.12)
        fireSkillRemotes("X")
        activateTool(slot2Tool, 2, 0.12)
        task.wait(0.12)
    end

    local slot3Tool = getToolBySlot(3)
    if slot3Tool then
        equipTool(slot3Tool)
        fireSkillRemotes("Z")
        activateTool(slot3Tool, 2, 0.12)
        task.wait(0.12)
        fireSkillRemotes("X")
        activateTool(slot3Tool, 2, 0.12)
        task.wait(0.12)
    end

    -- spam T + Y a few times
    for i=1,3 do
        fireSkillRemotes("T")
        fireSkillRemotes("Y")
        task.wait(0.08)
    end

    -- return to slot1
    local slot1Tool = getToolBySlot(1)
    if slot1Tool then
        equipTool(slot1Tool)
        activateTool(slot1Tool, 2, 0.12)
    end
end

-- ====== FASTER SAFE FLY (SMOOTH) ======
local function safeFlyToPosition(targetPos)
    local char = LocalPlayer.Character
    if not char then return false end
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return false end

    local maxAttempts = 2000
    local attempts = 0

    while (root.Position - targetPos).Magnitude > 6 and attempts < maxAttempts and LocalPlayer and LocalPlayer.Character do
        attempts = attempts + 1
        local dt = RunService.Heartbeat:Wait()
        local dirVec = (targetPos - root.Position)
        local dist = dirVec.Magnitude
        if dist <= 0 then break end

        -- compute desired step = speed * dt, but clamp to avoid big jumps
        local desiredStep = flySpeed * dt
        local step = math.clamp(desiredStep, 0.01, math.min(maxStepPerFrame, dist))

        -- add tiny smoothing factor (lerp) to orientation to look natural
        local newPos = root.Position + dirVec.Unit * step
        root.CFrame = CFrame.new(newPos, targetPos) -- face target

        -- small random micro-offset occasionally to imitate player micro-movement
        if attempts % 6 == 0 then
            local jitter = Vector3.new((math.random()-0.5)*0.4, (math.random()-0.5)*0.4, (math.random()-0.5)*0.4)
            root.CFrame = root.CFrame + jitter
        end
    end

    return true
end

local function getClosestTarget()
    local myChar = LocalPlayer.Character
    if not myChar or not myChar:FindFirstChild("HumanoidRootPart") then return nil end
    local myPos = myChar.HumanoidRootPart.Position
    local best, bestD = nil, math.huge
    for _,p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Humanoid") and p.Character:FindFirstChild("HumanoidRootPart") then
            local hum = p.Character:FindFirstChild("Humanoid")
            if hum and hum.Health > 0 then
                local d = (p.Character.HumanoidRootPart.Position - myPos).Magnitude
                if d < bestD then best, bestD = p, d end
            end
        end
    end
    return best
end

-- MAIN LOOP
task.spawn(function()
    while true do
        task.wait(0.8)
        local myChar = LocalPlayer.Character
        if not myChar or not myChar:FindFirstChild("Humanoid") then
            repeat task.wait(0.5) until LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
            myChar = LocalPlayer.Character
        end
        local myHum = myChar:FindFirstChild("Humanoid")
        if not myHum then task.wait(1); continue end

        -- retreat if low hp
        if myHum.Health / (myHum.MaxHealth > 0 and myHum.MaxHealth or 1) < lowHpThreshold then
            pcall(function() myChar:PivotTo(CFrame.new(myChar.PrimaryPart.Position + Vector3.new(0,300,0))) end)
            repeat task.wait(1) until myHum.Health / (myHum.MaxHealth > 0 and myHum.MaxHealth or 1) >= healHopThreshold or not myHum
            pcall(function() TeleportService:Teleport(game.PlaceId, LocalPlayer) end)
            break
        end

        local targetPlayer = getClosestTarget()
        if not targetPlayer then
            pcall(function() TeleportService:Teleport(game.PlaceId, LocalPlayer) end)
            break
        end

        if not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("HumanoidRootPart") or not targetPlayer.Character:FindFirstChild("Humanoid") then
            continue
        end
        local targetHRP = targetPlayer.Character.HumanoidRootPart
        local targetHum = targetPlayer.Character.Humanoid
        if (targetHum.Health / (targetHum.MaxHealth > 0 and targetHum.MaxHealth or 1)) <= 0.30 then
            continue
        end

        -- fly faster but smooth
        safeCall(safeFlyToPosition, targetHRP.Position + Vector3.new(0,5,0))

        -- attack loop
        local lastHealth = targetHum.Health
        local startNoDamageTick = tick()
        while targetPlayer and targetPlayer.Character and targetHum and targetHum.Health > 0 do
            local pct = targetHum.Health / (targetHum.MaxHealth > 0 and targetHum.MaxHealth or 1)
            if pct <= 0.30 then break end

            useSlotSequenceAndReturn()

            task.wait(0.9)

            if not targetHum or not targetHum.Parent then break end
            if targetHum.Health < lastHealth then
                lastHealth = targetHum.Health
                startNoDamageTick = tick()
            else
                if tick() - startNoDamageTick >= noDamageTimeout then
                    break
                end
            end

            if myHum.Health / (myHum.MaxHealth > 0 and myHum.MaxHealth or 1) < lowHpThreshold then
                pcall(function() myChar:PivotTo(CFrame.new(myChar.PrimaryPart.Position + Vector3.new(0,300,0))) end)
                repeat task.wait(1) until myHum.Health / (myHum.MaxHealth > 0 and myHum.MaxHealth or 1) >= healHopThreshold
                pcall(function() TeleportService:Teleport(game.PlaceId, LocalPlayer) end)
                return
            end
        end

        if targetHum and targetHum.Health <= 0 then
            task.wait(0.6)
            continue
        end

        task.wait(0.15)
    end
end)
