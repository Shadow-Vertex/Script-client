-- 🌊 Auto Bounty Hub (Safe Fly Version)
-- By ChatGPT

-- =======================
-- Custom Loading UI
-- =======================
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")

local LoadGui = Instance.new("ScreenGui")
LoadGui.Name = "AutoBountyLoader"
LoadGui.Parent = CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 400, 0, 150)
Frame.Position = UDim2.new(0.5, -200, 0.5, -75)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Frame.BorderSizePixel = 0
Frame.Parent = LoadGui
Frame.AnchorPoint = Vector2.new(0.5,0.5)
Frame.BackgroundTransparency = 0.2
Frame.ClipsDescendants = true
local UICorner = Instance.new("UICorner", Frame)
UICorner.CornerRadius = UDim.new(0,15)

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.Text = "🌊 Auto Bounty Hub"
Title.TextColor3 = Color3.fromRGB(0, 255, 200)
Title.TextScaled = true
Title.Font = Enum.Font.GothamBold
Title.Parent = Frame

local BarBG = Instance.new("Frame")
BarBG.Size = UDim2.new(0.9, 0, 0, 15)
BarBG.Position = UDim2.new(0.05, 0, 0.6, 0)
BarBG.BackgroundColor3 = Color3.fromRGB(50,50,50)
BarBG.BorderSizePixel = 0
BarBG.Parent = Frame
local UICorner2 = Instance.new("UICorner", BarBG)

local Bar = Instance.new("Frame")
Bar.Size = UDim2.new(0, 0, 1, 0)
Bar.BackgroundColor3 = Color3.fromRGB(0, 255, 200)
Bar.BorderSizePixel = 0
Bar.Parent = BarBG
local UICorner3 = Instance.new("UICorner", Bar)

local Status = Instance.new("TextLabel")
Status.Size = UDim2.new(1,0,0,40)
Status.Position = UDim2.new(0,0,0.75,0)
Status.BackgroundTransparency = 1
Status.Text = "Loading..."
Status.TextColor3 = Color3.fromRGB(200,200,200)
Status.TextScaled = true
Status.Font = Enum.Font.Gotham
Status.Parent = Frame

task.spawn(function()
    for i = 1,100 do
        TweenService:Create(Bar, TweenInfo.new(0.03, Enum.EasingStyle.Linear), {
            Size = UDim2.new(i/100, 0, 1, 0)
        }):Play()
        Status.Text = "Loading... " .. i .. "%"
        task.wait(0.03)
    end
    task.wait(0.3)
    TweenService:Create(Frame, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
    TweenService:Create(Bar, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
    TweenService:Create(BarBG, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
    TweenService:Create(Title, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
    TweenService:Create(Status, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
    task.wait(0.6)
    LoadGui:Destroy()
end)

-- =======================
-- Load Rayfield + Auto Load Config
-- =======================
task.delay(3, function()
    local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local RunService = game:GetService("RunService")

    -- SETTINGS
    local settings = {
        Melee = {Enabled=false, Keys={Z=false,X=false,C=false}},
        Fruit = {Enabled=false, Keys={Z=false,X=false,C=false,V=false,F=false}},
        Sword = {Enabled=false, Keys={Z=false,X=false}},
        Gun   = {Enabled=false, Keys={Z=false,X=false}},
        AutoBounty = false
    }

    -- ====== Dùng chiêu ======
    local function tryUseAbility(key)
        local char = LocalPlayer.Character
        if not char then return end
        local tool = char:FindFirstChildOfClass("Tool")
        if tool then pcall(function() tool:Activate() end) end

        local remoteFolder = ReplicatedStorage:FindFirstChild("Remotes")
        if remoteFolder then
            for _, r in pairs(remoteFolder:GetDescendants()) do
                if r:IsA("RemoteEvent") then
                    pcall(function()
                        r:FireServer("UseSkill", key)
                        r:FireServer(key)
                    end)
                end
            end
        end
    end

    -- ====== Safe Fly ======
    local function safeFlyTo(char, targetPos)
        local root = char:FindFirstChild("HumanoidRootPart")
        if not root then return end
        local speed = 60 -- stud/giây (40-80 an toàn)
        while settings.AutoBounty and targetPos and (root.Position - targetPos).Magnitude > 6 do
            local dir = (targetPos - root.Position).Unit
            root.CFrame = root.CFrame + dir * speed * RunService.Heartbeat:Wait()
        end
    end

    -- ====== Rayfield Window ======
    local Window = Rayfield:CreateWindow({
        Name = "Auto Bounty Hub",
        LoadingTitle = "Run script",
        LoadingSubtitle = "Script SDVT Team",
        ConfigurationSaving = {
            Enabled = true,
            FolderName = "AutoBountyHub",
            FileName = "settings"
        }
    })

    -- 👇 TỰ ĐỘNG LOAD CẤU HÌNH ĐÃ LƯU
    Window:LoadConfiguration()

    -- ====== Tab 1 Setting ======
    local Tab1 = Window:CreateTab("Settings", 11602940797)

    local function createSkillSection(tab, title, tbl, keys)
        local toggle = tab:CreateToggle({
            Name = title,
            CurrentValue = tbl.Enabled,
            Flag = "Toggle_" .. title:gsub(" ", ""), -- 👈 Thêm Flag để lưu riêng
            Callback = function(v)
                tbl.Enabled = v
            end
        })

        for _,k in ipairs(keys) do
            tab:CreateToggle({
                Name = "Use " .. k,
                CurrentValue = tbl.Keys[k],
                Flag = "Key_" .. title:gsub(" ", "") .. "_" .. k, -- 👈 Thêm Flag để lưu riêng
                Callback = function(v)
                    tbl.Keys[k] = v
                end
            })
        end
    end

    createSkillSection(Tab1, "Melee", settings.Melee, {"Z","X","C"})
    createSkillSection(Tab1, "Fruit", settings.Fruit, {"Z","X","C","V","F"})
    createSkillSection(Tab1, "Sword", settings.Sword, {"Z","X"})
    createSkillSection(Tab1, "Gun", settings.Gun, {"Z","X"})

    -- ====== Tab 2 Auto Bounty ======
    local Tab2 = Window:CreateTab("Auto Bounty", 4483362458)
    Tab2:CreateToggle({
        Name = "Enable Auto Bounty",
        CurrentValue = settings.AutoBounty,
        Flag = "AutoBounty", -- 👈 Thêm Flag để lưu riêng
        Callback = function(v)
            settings.AutoBounty = v
        end
    })

    -- ====== Core Auto Bounty ======
    task.spawn(function()
        while task.wait(1) do
            if not settings.AutoBounty then continue end
            local myChar = LocalPlayer.Character
            if not myChar or not myChar:FindFirstChild("Humanoid") then continue end
            local hum = myChar:FindFirstChild("Humanoid")
            if hum.Health/hum.MaxHealth < 0.3 then
                -- nếu máu <30% bay xa chờ hồi
                myChar:PivotTo(CFrame.new(0,300,0))
                repeat task.wait(1) until hum.Health/hum.MaxHealth >= 0.7
                -- hop sv
                game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer)
            end

            -- tìm đối thủ
            local target
            for _,plr in pairs(Players:GetPlayers()) do
                if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("Humanoid") then
                    target = plr.Character
                    break
                end
            end
            if not target then continue end

            -- bay đến target bằng safeFly
            local root = myChar:FindFirstChild("HumanoidRootPart")
            local targetRoot = target:FindFirstChild("HumanoidRootPart")
            if root and targetRoot then
                safeFlyTo(myChar, targetRoot.Position)
            end

            -- đánh theo setting
            for mode,data in pairs({Melee=settings.Melee,Fruit=settings.Fruit,Sword=settings.Sword,Gun=settings.Gun}) do
                if data.Enabled then
                    for k,enabled in pairs(data.Keys) do
                        if enabled then tryUseAbility(k) end
                    end
                end
            end
        end
    end)
end)
